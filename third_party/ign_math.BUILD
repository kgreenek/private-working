# Description:
#   A small, fast, and high performance math library. This library is a self-contained set of
#   classes and functions suitable for robot applications.

licenses(["notice"])  # Apache 2.0

exports_files(["LICENSE"])

cc_library(
    name = "ign_math",
    srcs = glob(
        ["src/*.cc"],
        exclude = ["src/*_TEST.cc"]
    ),
    hdrs = [
        ":config_hh",
        ":hdrs",
        ":math_hh",
    ],
    includes = ["include"],
    visibility = ["//visibility:public"],
)

filegroup(
    name = "hdrs",
    srcs = glob(["include/ignition/math/*.hh"]),
    visibility = ["//visibility:private"],
)

genrule(
    name = "config_hh",
    outs = ["ignition/math/config.hh"],
    cmd = """
        echo '/* Config.hh. Generated by CMake for ignition-math. */' >> $@
        echo '' >> $@
        echo '/* Version number */' >> $@
        echo '#define IGNITION_MATH_MAJOR_VERSION 3' >> $@
        echo '#define IGNITION_MATH_MINOR_VERSION 1' >> $@
        echo '#define IGNITION_MATH_PATCH_VERSION 0' >> $@
        echo '' >> $@
        echo '#define IGNITION_MATH_VERSION "3.1"' >> $@
        echo '#define IGNITION_MATH_VERSION_FULL "3.1.0"' >> $@
        echo '' >> $@
        echo '#define IGNITION_MATH_VERSION_HEADER "Ignition math, version 3.1.0\\nCopyright (C) 2014 Open Source Robotics Foundation.\\nReleased under the Apache 2.0 License.\\n\\n"' >> $@
        echo '' >> $@
        echo '/* #undef BUILD_TYPE_PROFILE */' >> $@
        echo '/* #undef BUILD_TYPE_DEBUG */' >> $@
        echo '#define BUILD_TYPE_RELEASE 1' >> $@
    """,
    visibility = ["//visibility:private"],
)

genrule(
    name = "math_hh",
    srcs = [
        ":config_hh",
        ":hdrs",
    ],
    outs = ["ignition/math.hh"],
    cmd = """
        echo '// Automatically generated' >> $@
        for src in $(SRCS); do
          echo '#include \"ignition/math/'"$$(basename $$src)"'\"' >> $@
        done
    """,
    visibility = ["//visibility:private"],
)
